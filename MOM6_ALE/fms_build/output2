

set workdir = $cwd
set root = $cwd:h:h:h

set platform = gfdl_hpcs
set mkmfTemplate = $root/MIDAS/fms/site/$platform/mkmf.template
set npes = 1

set sharedir = $root/shared
set includedir = $sharedir/{include,mosaic}
set mppincludedir = $sharedir/mpp/include

set MKMF = $root/MIDAS/fms/bin/mkmf

set cppDefs = ( "-Duse_netCDF -Duse_netCDF3 -Duse_libMPI" )
set LISTPATHS = $root/MIDAS/fms/bin/list_paths


if ( $platform == 'gfdl_hpcs' ) then
module load netcdf/4.2

module load intel_compilers

endif

cd $root
\rm path_names*
$LISTPATHS $sharedir
A list of the files you checked out is in the file path_names ...
Documentation on the files you checked out is accessible on the web at
file://localhost/net3/mjh/models/MOM6z/path_names.html ...
mv -f path_names pt_orig
egrep -v "atmos_ocean_fluxes|coupler_types|coupler_util|drifters|oda_tools" pt_orig > path_names

cd $workdir
\rm *.{o,mod}

$MKMF -m Makefile -a $root -t $mkmfTemplate -p libfms.a -c "$cppDefs" $root/path_names $includedir $mppincludedir
.......................................................................... Makefile is ready.

make NETCDF=3 libfms.a
ifort -Duse_netCDF -Duse_netCDF3 -Duse_libMPI -Duse_LARGEFILE  -fpp -Wp,-w -heap-arrays -fno-alias -stack_temps -safe_cray_ptr -ftz -i_dynamic -assume byterecl -i4 -r8 -nowarn -g -fPIC -O2  -c -I/net3/mjh/models/MOM6z/shared/include	/net3/mjh/models/MOM6z/shared/mpp/mpp_parameter.F90
Using 8-byte addressing
Using PURE
Converting pointers to allocatable components
ifort -Duse_netCDF -Duse_netCDF3 -Duse_libMPI -Duse_LARGEFILE  -fpp -Wp,-w -heap-arrays -fno-alias -stack_temps -safe_cray_ptr -ftz -i_dynamic -assume byterecl -i4 -r8 -nowarn -g -fPIC -O2  -c -I/net3/mjh/models/MOM6z/shared/include -I/net3/mjh/models/MOM6z/shared/mpp/include	/net3/mjh/models/MOM6z/shared/mpp/mpp_data.F90
Using 8-byte addressing
Using PURE
Converting pointers to allocatable components
icc -Duse_netCDF -Duse_netCDF3 -Duse_libMPI -Duse_LARGEFILE  -D__IFC  -fPIC -O2 -fast -I/net3/mjh/models/MOM6z/MIDAS/MOM6_ALE/fms_build/../shared -I/net3/mjh/models/MOM6z/MIDAS/MOM6_ALE/fms_build -I/net3/mjh/models/MOM6z/MIDAS/MOM6_ALE/fms_build/../../shared/mosaic -I/usr/local/x64/netcdf-4.2/include -I/usr/local/x64/hdf5-1.8.6/include  -O2  -c	/net3/mjh/models/MOM6z/shared/mpp/affinity.c
icc: command line warning #10120: overriding '-O2' with '-O2'
icc -Duse_netCDF -Duse_netCDF3 -Duse_libMPI -Duse_LARGEFILE  -D__IFC  -fPIC -O2 -fast -I/net3/mjh/models/MOM6z/MIDAS/MOM6_ALE/fms_build/../shared -I/net3/mjh/models/MOM6z/MIDAS/MOM6_ALE/fms_build -I/net3/mjh/models/MOM6z/MIDAS/MOM6_ALE/fms_build/../../shared/mosaic -I/usr/local/x64/netcdf-4.2/include -I/usr/local/x64/hdf5-1.8.6/include  -O2  -c -I/net3/mjh/models/MOM6z/shared/mosaic	/net3/mjh/models/MOM6z/shared/mosaic/gradient_c2l.c
icc: command line warning #10120: overriding '-O2' with '-O2'
ifort -Duse_netCDF -Duse_netCDF3 -Duse_libMPI -Duse_LARGEFILE  -fpp -Wp,-w -heap-arrays -fno-alias -stack_temps -safe_cray_ptr -ftz -i_dynamic -assume byterecl -i4 -r8 -nowarn -g -fPIC -O2  -c -I/net3/mjh/models/MOM6z/shared/include -I/net3/mjh/models/MOM6z/shared/mpp/include	/net3/mjh/models/MOM6z/shared/mpp/mpp.F90
/net3/mjh/models/MOM6z/shared/mpp/mpp.F90(214): error #6404: This name does not have a type, and must have an explicit type.   [GET_ASCII_FILE_NUM_LINES]
  public :: get_ascii_file_num_lines
------------^
/net3/mjh/models/MOM6z/shared/mpp/mpp.F90(215): error #6404: This name does not have a type, and must have an explicit type.   [MPP_RECORD_TIME_START]
  public :: mpp_record_time_start, mpp_record_time_end
------------^
/net3/mjh/models/MOM6z/shared/mpp/mpp.F90(215): error #6404: This name does not have a type, and must have an explicit type.   [MPP_RECORD_TIME_END]
  public :: mpp_record_time_start, mpp_record_time_end
-----------------------------------^
Using 8-byte addressing
Using PURE
Converting pointers to allocatable components
compilation aborted for /net3/mjh/models/MOM6z/shared/mpp/mpp.F90 (code 1)
make: *** [mpp.o] Error 1




if ( $status ) then
unset echo
echo ERROR: make failed.
ERROR: make failed.
exit 1
